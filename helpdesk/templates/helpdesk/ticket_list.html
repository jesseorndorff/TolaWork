{% extends "base.html" %}{% load i18n %}
{% block helpdesk_title %}{% trans "Tickets" %}{% endblock %}

{% block helpdesk_head %}
<style type="text/css" src='{{ STATIC_URL }}helpdesk/app.css'></style>


{% endblock %}

{% block content %}
{% load in_list %}


<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<div class="container">
<h3>Submitted Tickets</h3>


    {% if not number_of_tickets%}
    <strong> <span class="badge"> No records found</span></strong>
    {%else%}
    <strong> <span class="badge">{{number_of_tickets }} Record(s) found</span></strong>
    {%endif%}

<!-- main div -->
  <div class="ticket_cover">
        <div class="col-md-9 col-sm-9 ticket_right">
              {% for ticket in tickets.object_list %}
              <div class="panel panel-info">
                <div class="panel-heading"> <a href='{{ ticket.get_absolute_url }}'>{{ ticket.ticket | upper}}</a> <strong class="font8"> {{ ticket.title }} </strong> <br>
                Reported on {{ ticket.created | date}}, {{ ticket.created | time}} by {{ ticket.submitter_email }}  </div>
                <div class="panel-body">
                <p class="description">{{ ticket.description }}</p>
                </div>
                <div class="panel-footer">
                    <span class="glyphicon glyphicon-tags"></span> <strong> Tags:</strong> {% for tag in ticket.tags.all %}
                      <span class="label label-info">{{tag}}</span>
                    {% endfor %}
    |               <span class="glyphicon glyphicon-cog"></span><strong> Tasks</strong>
                    <!-- <div class="read_more"><a href="#">Read More...</a></div> -->
                </div>
              </div>
            {% endfor %}



            <!-- start paginator -->
          <div>
               <ul class="pagination">
                 {% if tickets.has_previous %}
                     <li><a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ tickets.previous_page_number }}"> {% trans "Previous" %} </a></li>
                     <li><a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ tickets.previous_page_number }}"> {{tickets.previous_page_number}} </a></li>
                 {% endif %}
                  {% blocktrans with tickets.number as ticket_num %}
                      <li><a class="active" href=" page= {tickets.paginator.num_pages as num_pages %} "> {{ ticket_num }}</a></li>
                  {% endblocktrans %}
                  
                 {% if tickets.has_next %}
                     <li><a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ tickets.next_page_number }}"> {{ tickets.next_page_number }}</a></li>
                     {% blocktrans with tickets.paginator.num_pages as num_pages %}
                      <li><a href="#">...</a></li>
                    <li><a href="#">{{ num_pages }} </a></li>
                  {% endblocktrans %}
                     <li><a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ tickets.next_page_number }}">{% trans "Next" %}</a></li>

                 {% endif %}
                 </ul>
                 <div class="read_more">
                   <ul class="pagination">
                     <li>
                        <a class = "{% if items_per_page == 5 %} active {% endif %}"
                          href="{% url 'helpdesk_list' %}?items_per_page=5">5</a>
                      </li>
                     <li>
                        <a class = "{% if items_per_page == 10 %} active {% endif %}"
                          href="{% url 'helpdesk_list' %}?items_per_page=10">10 </a>
                      </li>
                     <li>
                        <a class = "{% if items_per_page == 20 %} active {% endif %}"
                          href="{% url 'helpdesk_list' %}?items_per_page=20" >20</a>
                      </li>
                     <li><a href="#">per page</a></li>
                   </ul>
                 </div> 
            </div>
            <!-- end paginator -->
        </div>
        <div class="col-md-3 col-sm-3 ">
       <!-- start search -->
          <div class="search" >
            <form class="input-group" id='searchform' method='get' action="{% url 'helpdesk_list' %}">
                <input type="text" name='q' class="form-control" placeholder="Search" id='search_query'>
                <span class="input-group-btn">
                  <button class="btn btn-info" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
              </form>
          </div>
          <!-- end search -->

          <!-- start filters -->
          <div>
            <div class="panel panel-info ">
              <div class="panel-heading">
                <strong>Issues <span class="badge">{{ num_tickets }}</span></strong>
                <a href="/helpdesk/tickets/submit">
                  <div class="ticket_issues">
                    <span class="glyphicon glyphicon-plus"></span>New Issue
                  </div>
                </a>
              </div>
                <form action="" method="get" action="./" >
                  <div class="panel-body ">
                      <select class="btn btn-default form-control dropdown-toggle" id="issues" name="my_issues">
                          <option  value="" selected="selected">---See Issues---</option>
                          <option  value="created_by_me">Created By Me ({{ mine }})</option>
                          <option value="">Assigned to Me ({{ assigned }})</option>
                          <option value="">Resolved by Me ({{reclosed}})</option>
                      </select>
                    </div>
                </form>
            </div>
            <div class="panel panel-info">
                <div class="panel-heading"> <strong>Sort By</strong></div>
                <div class="panel-body ">
                    <form method='get' action='./'>
                        <select   class="btn btn-default dropdown-toggle" id='id_sort' name='sort'>
                            <option value='created'{% ifequal query_params.sorting "created"%} selected='selected'{% endifequal %}>
                                {% trans "Created" %}
                            </option>
                            <option value='title'{% ifequal query_params.sorting "title"%} selected='selected'{% endifequal %}>
                                {% trans "Title" %}
                            </option>
                            <option value='queue'{% ifequal query_params.sorting "queue"%} selected='selected'{% endifequal %}>
                                {% trans "Queue" %}
                            </option>
                            <option value='status'{% ifequal query_params.sorting "status"%} selected='selected'{% endifequal %}>
                                {% trans "Status" %}
                            </option>
                            <option value='priority'{% ifequal query_params.sorting "priority"%} selected='selected'{% endifequal %}>
                                {% trans "Priority" %}
                            </option>
                            <option value='assigned_to'{% ifequal query_params.sorting "assigned_to"%} selected='selected'{% endifequal %}>
                                {% trans "Owner" %}
                            </option>
                            <option value='assigned_to'{% ifequal query_params.sorting "type"%} selected='selected'{% endifequal %}>
                                {% trans "Type" %}
                            </option>
                            <option value='votes'{% ifequal query_params.sorting "votes"%} selected='selected'{% endifequal %}>
                                {% trans "Most Vote Up" %}
                            </option>
                          </select>
                         <input class="btn btn-primary read_more " type='submit' value='{% trans "Apply " %}' />
                        </form>
                </div>
              </div>
              <div class="panel panel-info">
                <div class="panel-heading"> <strong>Issues By Year/Month</strong></div>
                <div class="panel-body sort_panels">
                <b><span class="glyphicon glyphicon-plus"></span></b> 2016
                </div>
              </div>
              <div class="panel panel-info">
                <div class="panel-heading"> <strong>Filter Issues By Type</strong></div>
                <div class="panel-body ">
                <form>
                <select class="btn btn-default dropdown-toggle">
                    <option>Feature Request</option>
                    <option>Suggestion</option>
                  </select>
                  <input class="btn btn-primary read_more " type='submit' value='{% trans "Apply " %}' />
                </form>
                </div>
              </div>
              <div class="panel panel-info">
                <div class="panel-heading"> <strong>Filter Issues By Status</strong>

                </div>
                  <div class="panel-body ">
                                   <form method='get' action='./'>
                        <select id='id_statuses' name='status' multiple='selected' size='5'>{% for s in status_choices %}
                      <option value='{{ s.0 }}'{% if s.0|in_list:query_params.filtering.status__in %} selected='selected'{% endif %}>{{ s.1 }}</option>{% endfor %}</select>
                      <input class="btn btn-primary read_more " type='submit' value='{% trans "Apply " %}' />
                    </form>
                </div>
              </div>
          </div>
          <!-- end filters -->
        </div>
</div>
</div>
</div>
<script type="text/javascript">
  $(document).ready(function() {
      // Configure/customize these variables.
      var showChar = 230;  // How many characters are shown by default
      var ellipsestext = "...";
      var moretext = "Show more >";
      var lesstext = "Show less";


      $('.description').each(function() {
          var content = $(this).html();

          if(content.length > showChar) {

              var c = content.substr(0, showChar);
              var h = content.substr(showChar, content.length - showChar);

              var html = c  + ellipsestext+ '<span class="morecontent"><span>' + h + '</span><a href="" class="morelink read_more">' + moretext + '</a></span>';

              $(this).html(html);
          }

      });

      $(".morelink").click(function(){
          if($(this).hasClass("less")) {
              $(this).removeClass("less");
              $(this).html(moretext);
          } else {
              $(this).addClass("less");
              $(this).html(lesstext);
          }
          $(this).parent().prev().toggle();
          $(this).prev().toggle();
          return false;
      });
  });
</script>
{% endblock content %}
