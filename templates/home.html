{% extends "base.html" %}

{% block content %}

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="{{ STATIC_URL }}js/highcharts/js/highcharts.js"></script>
<script src="{{ STATIC_URL }}js/highcharts/js/modules/exporting.js"></script>

<script>

$(function () {

    $(document).ready(function () {

        // Build the chart
        $('#pie_container').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie',
                backgroundColor: 'transparent'
            },
            title: {
                text: 'Tickets Open/Closed'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: false
                    },
                    showInLegend: true
                }
            },

            series: [{
                name: "Type",
                colorByPoint: true,
                data: [
                {% for item in tickets %}
                    {
                        name: "{% if item.status == 1 %} Open {%elif item.status == 2%}Re-Opened{% elif item.status == 3%}Resolved{% elif item.status == 4%}Closed{% elif item.status == 5%}Duplicate{% endif %}",
                        y: {{ item.total }}
                    },
                {% endfor %}
                ]
            }]
        });

    });

});

</script>
<div class="container col-md-12">
  <div class="home_cover">
    <div class=" col-md-9 col-sm-9 main_home">
        <div class="col-md-12 col-sm-12">
            <h2> <strong>Tola</strong>Work</h2>
          <p class="font7">Get help setting up, using and configuring Tola Activity, Tola Tables and Mobile Data collection platforms and M&E in general.  Report any issues with tools and request  and vote on new features.</p>
          <br/>
          <a href="/helpdesk/tickets/submit" class="btn btn-lg btn-success"><b><span class="glyphicon glyphicon-plus"></span></b> Enter a Ticket</a>
          <br/>
          <h3>Tickets, Tasks and <strong>Tola</strong>Data Tools</h3>
          <div class="home-bottom">
          <div class="panel_bottom">
             <div class="panel-group" id="accordion">
              <div class="panel home-panel">
                <div class="panel-heading home-paneltitle">
                    <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#tickets"><font class="font5"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;Tickets</font></a></h4>
                </div>
                <div id="tickets" class="panel-collapse collapse">
                  <div class="panel-body">
                    <ul class="nav nav-tabs">
                      <li class="active">
                          <a data-toggle="tab" href="#enhancements">
                          <b><span class="glyphicon glyphicon-th"></span></b>&nbsp;&nbsp;Top Enhancement Requests</a>
                      </li>
                      <li>
                        <a data-toggle="tab" href="#Recent"><b><span class="glyphicon glyphicon-list-alt"></span></b>&nbsp;&nbsp;Recent Tickets</a>
                      </li>
                      {% if user.is_authenticated %}
                        <li>
                          <a data-toggle="tab" href="#Preview"><b><span class="glyphicon glyphicon-th-list"></span></b>&nbsp;&nbsp;Tickets Preview</a>
                        </li>
                      {% endif %}
                    </ul>

                    <div class="tab-content">
                      <div id="enhancements" class="tab-pane fade in active">
                        <div class=" col-md-12 table-responsive">
                          <table class="table table-striped">
                              <tr>
                                  <th>Queue</th>
                                  <th>Title</th>
                                  <th>Votes</th>
                              </tr>
                              {% for item in votes_tickets %}
                              <tr>
                                  <td>{{ item.queue }}</td>
                                  <td><a href="/helpdesk/tickets/{{ item.id }}/">{{ item.title }}</a></td>
                                  <td>{{ item.votes }}</td>
                              </tr>
                              {% endfor %}
                          </table>
                        </div>
                      </div>
                      <div id="Recent" class="tab-pane fade">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <tr>
                                    <th>Status</th>
                                    <th>Queue</th>
                                    <th>Title</th>
                                    <th>Date Created</th>
                                </tr>
                                {% for item in recent_tickets %}
                                <tr>
                                    <td>{% if item.status == 1 %} Open {%elif item.status == 2%}Re-Opened{% elif item.status == 3%}Resolved{% elif item.status == 4%}Closed{% elif item.status == 5%}Duplicate{% endif %}</td>
                                    <td>{{ item.queue }}</td>
                                    <td><a href="/helpdesk/tickets/{{ item.id }}/">{{ item.title }}</a></td>
                                    <td>{{ item.created }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                          </div>
                      </div>
                      <div id="Preview" class="tab-pane fade">
                         <div class="panel panel-info ">
                          <div class="panel-heading">
                            <strong>Total Tickets <span class="badge read_more">{{ num_tickets }}</span></strong>
                          </div>
                          <div class="panel-body">
                            <div class="sort_panels" >
                              <div class= "preview_links">
                                 <a href="#Created_by_me" data-toggle="collapse">Created By Me </a> <strong> <span class="badge read_more"> {{ created_by_me }} </span></strong>
                              </div>
                              <div id="Created_by_me" class="collapse in">
                                <div class="table-responsive">
                                  <table class="table table-striped">
                                      <tr>
                                          <th>Status</th>
                                          <th>Queue</th>
                                          <th>Title</th>
                                          <th>Date Created</th>
                                      </tr>
                                      {% for ticket in byme %}
                                      <tr>
                                          <td> {% if ticket.status == 1 %} Open {%elif ticket.status == 2%}Re-Opened{% elif ticket.status == 3%}Resolved{% elif ticket.status == 4%}Closed{% elif ticket.status == 5%}Duplicate{% endif %}</td>
                                          <td>{{ticket.queue}}</td>
                                          <td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
                                          <td> {{ticket.created}}</td>
                                      </tr>
                                      {%endfor%}
                                      <p><strong>&nbsp;Recent tickets created by Me.</strong></p>
                                  </table>
                                </div>
                              </div> 
                            </div>
                            <div class="sort_panels">
                              <div class= "preview_links">
                                <a href="#assigned_to_me" data-toggle="collapse">&nbsp;Assigned to Me</a> <strong><span class="badge read_more"> {{ assigned_to_me }} </span></strong>
                              </div>
                               <div id="assigned_to_me" class="collapse">
                                <div class="table-responsive">
                                  <table class="table table-striped">
                                      <tr>
                                          <th>Status</th>
                                          <th>Queue</th>
                                          <th>Title</th>
                                          <th>Date Created</th>
                                      </tr>
                                      {% for ticket in tome %}
                                      <tr>
                                          <td> {% if ticket.status == 1 %} Open {%elif ticket.status == 2%}Re-Opened{% elif ticket.status == 3%}Resolved{% elif ticket.status == 4%}Closed{% elif ticket.status == 5%}Duplicate{% endif %}</td>
                                          <td>{{ticket.queue}}</td>
                                          <td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
                                          <td> {{ticket.created}}</td>
                                      </tr>
                                      {%endfor%}
                                      <p><strong>Recent tickets assigned to me.</strong></p>
                                  </table>
                                </div>
                              </div> 
                            </div>
                             <div class="sort_panels">
                               <div class= "preview_links">
                                 <a href="#closed_resolved" data-toggle="collapse">&nbsp;Resolved & Closed by Me </a> <strong> <span class="badge read_more"> {{ closed_resolved }} </span></strong>
                               </div>  
                               <div id="closed_resolved" class="collapse">
                                <div class="table-responsive">

                                  <table class="table table-striped">

                                      <tr>
                                          <th>Status</th>
                                          <th>Queue</th>
                                          <th>Title</th>
                                          <th>Date Created</th>
                                      </tr>
                                      {% for ticket in closed %}
                                      <tr>
                                          <td> {% if ticket.status == 1 %} Open {%elif ticket.status == 2%}Re-Opened{% elif ticket.status == 3%}Resolved{% elif ticket.status == 4%}Closed{% elif ticket.status == 5%}Duplicate{% endif %}</td>
                                          <td>{{ticket.queue}}</td>
                                          <td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
                                          <td> {{ticket.created}}</td>
                                      </tr>
                                      {%endfor%}
                                      <p><strong>Recent tickets resolved and closed by me</strong></p>
                                  </table>

                                </div>
                               </div>
                             </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% if user.is_authenticated %}
                <div class="panel panel-success">
                  <div class="panel-heading ">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-parent="#accordion" href="#tasks"> <font > <span class="glyphicon glyphicon-tasks"></span>&nbsp;&nbsp;Tasks</font></a>
                    </h4>
                  </div>
                  <div id="tasks" class="panel-collapse collapse">
                    <div class="panel-body">
                      <table class="table table-striped table-bordered">
                        <tr class="info">
                          <td><strong>Task Title</strong></td>
                          <td><strong>Start Date</strong></td>
                          <td><strong>Due Date</strong></td>
                          <td><strong>Status</strong></td>
                          <td><strong>Priority</strong></td>
                          <td><strong>Assigned To</strong></td>
                        </tr>
                        {% for task in tasks %}
                          <tr data-toggle="collapse" data-target="#{{ task.id }}" class="accordion-toggle">

                          <td><strong><a href= "{% url 'task_list' %}">{{ task.task }}</a></strong></td>
                          <td>{{ task.created_date | date}}</td>
                          <td>{{ task.due_date | date}}</td>
                           <td> {% if task.status == 1 %} Active {%elif task.status == 2%}Re-Opened{% elif task.status == 3%}Closed{% elif task.status == 4%}Cancelled  {% endif %}</td>
                            <td> {% if task.priority == 1 %} High {% elif task.priority == 2 %} Normal {% elif task.priority == 3 %} Low {% endif %}</td>

                          <td>{{task.assigned_to}}</td>
                          {% endfor %}
                        </tr>
                        </table>
                    </div>
                  </div>
                </div>
              {% endif %}
              <div class="panel panel-info">
                <div class="panel-heading ">
                  <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#tools"> <font ><span class="glyphicon glyphicon-cog"></span>&nbsp;&nbsp;Tola<strong>Data</strong> Tools</font></a>
                  </h4>
                </div>
                <div id="tools" class="panel-collapse collapse in">
                <div class="panel-body">
                  
                  <ul class="nav nav-tabs">
                    <li class="active ">
                      <a data-toggle="tab" href="#tables"> <div class="tolatables"> <img src="{{ STATIC_URL }}img/tola-tables-icon-blue.png" class="icon"> Tola Tables </div></a>
                    </li>
                    <li>
                      <a data-toggle="tab" href="#activity">
                        <div class="tolaactivity"><img src="{{ STATIC_URL }}img/tola-activity-icon-orange.png" class="icon"> Tola Activity</div>
                      </a>
                    </li>
                    <li><a data-toggle="tab" href="#ona"><div class="ona">ONA Mobile Platform</div></a></li>
                  </ul>

                  <div class="tab-content">
                    <div id="tables" class="tab-pane fade in active">
                    {% if user.is_authenticated %}
                      {% if tolaTablesData.tables %}
                        <h4>Your Tables</h4>
                        <div class=" table-responsive">
                          <table class="table table-striped">
                              <tr>
                                  <th>Name</th>
                                  <th>Description</th>
                                  <th>Public</th>
                                  <th>Date Created</th>
                              </tr>
                              {% for table in tolaTablesData.tables %}
                                <tr>
                                    <td>{{table.name}}</td>
                                    <td>{{table.description}}</td>
                                    <td>{{table.public}}</td>
                                    <td>{{table.create_date}} </td>
                                </tr>
                               {% endfor %}
                          </table>
                          </div>
                        {% else %}
                        <div class="alert alert-info" role="alert">
                          <h5>You currently have no tables on Tolatables. Go to <a href="#" class="alert-link">TolaTables</a> to create a table(s)</h5>
                        </div>
                        {% endif %}
                      {% else %}
                        <div class="alert alert-info" role="alert">
                          <h5>Kindly<a href="#" class="alert-link"> Login</a> to see a list of Tables you own on TolaTables.</h5>
                      </div>
                      {% endif %}
                      <div class="row activity_details">
                        <div class="col-md-3">
                           <strong>Latest Release:</strong> <a href="{{ tola_url }}"><span class="badge">{{ tola_number }}</span></a>
                        </div>
                        <div class="col-md-3">
                            <strong>Status:</strong> {% if data_up == 0 %} SERVER IS DOWN {% else %} Server is up!{% endif %}
                        </div>
                        <div class="col-md-2">
                           <img src="https://travis-ci.org/toladata/TolaTables.svg?branch=master">
                        </div>
                      </div>  
                    </div>
                    <div id="activity" class="tab-pane fade">
                      {% if tolaActivityData %}
                        <h4>Latest Projects</h4>
                        <div class=" table-responsive">
                          <table class="table table-striped">
                              <tr>
                                  <th>Project</th>
                                  <th>Program</th>
                                  <th>Status</th>
                                  <th>Date Created</th>
                              </tr>
                              {% for data in tolaActivityData.projects %}
                                <tr>
                                    <td>{{data.project_name}}</td>
                                    <td>{{data.program.name}}</td>
                                    <td>{{data.approval}}</td>
                                    <td>{{data.create_date}}</td>
                                </tr>
                               {% endfor %}
                          </table>
                          </div>
                        {% else %}

                          <div class="alert alert-warning" role="alert">
                            <h5>There was a Problem loading Project(s) From <a href="#" class="alert-link">TolaActivity</a></h5>
                        </div>
                        {% endif %}
                        <div class="row activity_details">
                          <div class="col-md-4">
                             <strong>Latest Release:</strong> <a href="{{ tola_activity_url }}"><span class="badge">{{ tola_activity_number }}</span></a>
                          </div>
                          <div class="col-md-3">
                              <strong>Status:</strong> {% if data_up == 0 %} SERVER IS DOWN {% else %} Server is up!{% endif %}
                          </div>
                          <div class="col-md-2">
                             <img src="https://travis-ci.org/toladata/TolaActivity.svg?branch=master">
                          </div>
                        </div>    
                    </div>
                    <div id="ona" class="tab-pane fade">
                      <div class="list-group-item col-md-6">
                      Start using <a href="https://ona.io/home/">Ona</a> and easily collect your data in the field. Are you already using Ona and you'd like the enterprise features? Just fill out this <a href="https://docs.google.com/forms/d/1dhhDPNgr7a8gEBI9U1dr_b61v6rlOP5ca3e2g6Box_g/viewform?edit_requested=true">form</a> and your Ona account will be added to one of our enterprise organizations.<hr/>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div> 
            
            </div>
        </div>
      </div>
  </div>
    <div class="row">
        <div class="col-md-3 col-sm-3 minor_home">
          {%if user.is_staff%}
            <div class="col-md-10 col-md-offset-2 githubsync">
              <a href="{% url 'gitissueupdate' %}" class="btn btn-info"><b><span class="glyphicon glyphicon-refresh"></span></b> Sync Issues with Github</a>
            </div>
          {% endif %}
    <!-- //the pie chart -->
        <div class=" pie">
            <div id="pie_container">
            </div>
        </div>
        <br>
        <br>
        <br>
        <div class= "logged_in_users">
          <h4>Users Online:</h4>
          
            <div id="active_users">
              {% if user.is_authenticated %}
                <p><a href="{% url 'user' %}?email={{request.user.email}}"><span class="glyphicon glyphicon-user"></span>  {{ request.user.username }} (You)</a> - TolaWork</p>
              {% endif %}

              {% if logged_users%}
                {% for user in logged_users%}
                  <p><a href="{% url 'user' %}?email={{user.email}}&username={{user.username}}"><span class="glyphicon glyphicon-user"></span> {{user.username}}</a> - TolaWork</p>
                {% endfor %}
              {% endif %}
              {%if tolaActivityData.activity_logged_users %}
                  {% for user in tolaActivityData.activity_logged_users %}
                     <p><a href="#"><span class="glyphicon glyphicon-user"></span> {{user.username}}</a> - TolaActivity</p>
                  {% endfor %}
              {% endif %}

              {%if tolaTablesData.table_logged_users %}
                  {% for user in tolaTablesData.table_logged_users %}
                     <p><a href="#"><span class="glyphicon glyphicon-user"></span> {{user.username}}</a> - TolaTables</p>
                  {% endfor %}
              {% endif %}
            </div>
       </div> 
         
      </div>
    </div>
  </div>
</div>


{% endblock content %}
